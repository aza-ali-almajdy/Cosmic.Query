<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Learning Flashcard</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0F0C29;
            --bg-mid: #302B63;
            --bg-light: #24243E;
            --accent-cyan: #00F5D4;
            --accent-magenta: #9B5DE5;
            --text-light: #F6F7F8;
            --text-mid: #A9A8C3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-mid) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }

        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M3.236 67.5L0 50l3.236-17.5L20.736 25l17.5-17.5L50 0l11.764 7.5L79.264 25l17.5 17.5L100 50l-3.236 17.5L79.264 75l-17.5 17.5L50 100l-11.764-7.5L20.736 75z' fill='%23fff' fill-opacity='.1'/%3E%3C/svg%3E");
            animation: move-stars 120s linear infinite;
        }
        
        @keyframes move-stars {
            from { background-position: 0 0; }
            to { background-position: 0 1000px; }
        }


        .mobile-card-container {
            width: 375px;
            height: 667px;
            max-height: 95vh; /* So it doesn't get cut off on shorter screens */
            perspective: 2000px;
            z-index: 1;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.9s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }
        
        .card-inner.is-flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background-color: var(--bg-light);
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.1) 1px, transparent 0);
            background-size: 20px 20px;
            border-radius: 30px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 30px; /* Reduced vertical padding */
            text-align: center;
        }
        
        .card-face > main {
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            gap: 15px; /* Reduced gap */
        }
        
        .card-back {
            transform: rotateY(180deg);
        }
        
        .card-header, .card-footer {
             width: 100%;
             z-index: 2;
        }

        .card-footer {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            padding-top: 10px; /* Reduced space above the footer */
        }
        
        .card-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            color: var(--text-light);
            text-shadow: 0 0 10px var(--accent-cyan);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* Question Side (Front) */
        .planet-container {
            position: relative;
            animation: float 6s ease-in-out infinite;
        }
        
        .planet-svg {
            width: 200px;
            height: auto;
        }

        .question-mark-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            color: white;
            opacity: 0.8;
            text-shadow: 0 0 15px rgba(0, 245, 212, 0.7);
        }
        
        .question-text-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 245, 212, 0.3);
            min-height: 80px;
            width: 100%;
        }

        .question-text-box p:first-child {
            color: var(--text-mid);
            font-size: 14px;
        }
        .question-text-box p:last-child {
            color: var(--text-light);
            font-size: 20px;
            font-weight: 600;
        }

        /* Answer Side (Back) */
        .astronaut-container {
            width: 150px;
            height: auto;
            animation: float 8s ease-in-out infinite reverse;
        }

        .answer-box {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(155, 93, 229, 0.5);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
            min-height: 150px;
        }

        .answer-sentence {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-light);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .answer-sentence .highlight {
            color: var(--accent-cyan);
            font-weight: 700;
            text-shadow: 0 0 8px var(--accent-cyan);
        }
        
        .grammar-explanation {
            font-size: 14px;
            color: var(--text-mid);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 8px;
        }

        .grammar-explanation i {
            color: var(--accent-magenta);
        }

        .tts-button {
            background: none;
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .tts-button:hover {
            background: var(--accent-cyan);
            color: var(--bg-dark);
        }
        
        .action-button {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            color: var(--bg-dark);
            border: none;
            padding: 15px 20px;
            width: 100%;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 10px 25px -10px var(--accent-cyan);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .action-button.secondary {
            background: rgba(0,0,0,0.2);
            color: var(--text-light);
            border: 1px solid var(--accent-magenta);
            box-shadow: none;
        }

        .action-button:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px -10px var(--accent-magenta);
        }

        .action-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
            animation: pulse 1.5s infinite;
        }

        .teacher-name {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            font-weight: 700;
            color: var(--text-light);
            text-shadow: 0 0 10px var(--accent-cyan), 0 0 20px var(--accent-magenta);
            z-index: 100;
            padding: 8px 20px;
            background-color: rgba(48, 43, 99, 0.5);
            border: 1px solid rgba(0, 245, 212, 0.3);
            border-radius: 50px;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 245, 212, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 245, 212, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 245, 212, 0); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        
        @media (max-width: 767px) {
            body {
                padding: 0;
            }
            .teacher-name {
                font-size: 18px;
                top: 15px;
            }
            .mobile-card-container {
                width: 100%;
                height: 100dvh; /* Use dynamic viewport height for better mobile handling */
                height: -webkit-fill-available;
                max-height: none;
            }
            .card-face {
                border-radius: 0;
                padding: 20px 15px; /* Adjust horizontal padding */
                justify-content: space-between; /* Better vertical spacing */
            }
            .planet-svg {
                width: clamp(150px, 45vw, 180px); /* Fluid width */
            }
            .astronaut-container {
                width: clamp(110px, 35vw, 130px); /* Fluid width */
            }
            .card-title, .answer-sentence {
                font-size: clamp(20px, 5.5vw, 22px); /* Fluid font size */
            }
            .question-text-box p:last-child {
                font-size: clamp(16px, 4.8vw, 18px); /* Fluid font size */
            }
        }
    </style>
</head>
<body>
    <div class="teacher-name">T. Azza</div>
    <div class="stars"></div>
    <div class="mobile-card-container">
        <div class="card-inner" id="cardInner">
            <!-- Front of Card (Question) -->
            <div class="card-face card-front">
                <header class="card-header">
                    <h2 class="card-title"><i class="fas fa-satellite-dish"></i> Cosmic Query</h2>
                </header>
                
                <main>
                    <div class="planet-container">
                        <i class="fas fa-question question-mark-icon"></i>
                        <svg class="planet-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <radialGradient id="planetGradient" cx="30%" cy="30%" r="70%">
                                    <stop offset="0%" style="stop-color: #9B5DE5;" />
                                    <stop offset="100%" style="stop-color: #302B63;" />
                                </radialGradient>
                                <filter id="glow">
                                    <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
                                    <feMerge>
                                        <feMergeNode in="coloredBlur"/>
                                        <feMergeNode in="SourceGraphic"/>
                                    </feMerge>
                                </filter>
                            </defs>
                            <path d="M 100,55 A 100,30 0 1 0 100,145 A 100,30 0 1 0 100,55 Z" fill="none" stroke="#00F5D4" stroke-width="3" filter="url(#glow)"/>
                            <circle cx="100" cy="100" r="60" fill="url(#planetGradient)" />
                        </svg>
                    </div>
                    <div class="question-text-box" id="questionBox">
                        <p id="questionPrompt"></p>
                        <p id="questionContent"></p>
                    </div>
                </main>

                <footer class="card-footer">
                    <button class="action-button" onclick="flipCard()">
                        <span>Reveal Answer</span>
                        <i class="fas fa-rocket"></i>
                    </button>
                </footer>
            </div>

            <!-- Back of Card (Answer) -->
            <div class="card-face card-back">
                <header class="card-header">
                     <h2 class="card-title"><i class="fas fa-user-astronaut"></i> Mission Debrief</h2>
                </header>

                <main>
                    <svg class="astronaut-container" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="astronautGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#F6F7F8;"/>
                                <stop offset="100%" style="stop-color:#A9A8C3;"/>
                            </linearGradient>
                            <filter id="astroGlow">
                                <feDropShadow dx="0" dy="0" stdDeviation="3" flood-color="#9B5DE5"/>
                            </filter>
                        </defs>
                        <g filter="url(#astroGlow)">
                            <path fill="#302B63" d="M50 8c-8.8 0-16 7.2-16 16s7.2 16 16 16 16-7.2 16-16S58.8 8 50 8z"/>
                            <path fill="url(#astronautGradient)" d="M50 10c-7.7 0-14 6.3-14 14s6.3 14 14 14 14-6.3 14-14-6.3-14-14z"/>
                            <path fill="#00F5D4" d="M40 20h20v8H40z" opacity="0.7"/>
                            <path fill="url(#astronautGradient)" d="M68 40H32c-4.4 0-8 3.6-8 8v28c0 4.4 3.6 8 8 8h36c4.4 0 8-3.6 8-8V48c0-4.4-3.6-8-8-8z"/>
                            <rect x="45" y="55" width="10" height="10" rx="2" fill="#302B63"/>
                        </g>
                    </svg>
                    <div class="answer-box">
                        <button class="tts-button" id="ttsButton" onclick="speakAnswer()">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <p class="answer-sentence" id="answerSentence"></p>
                        <div class="grammar-explanation" id="grammarExplanation">
                           <i class="fas fa-info-circle"></i>
                           <span></span>
                        </div>
                    </div>
                </main>
                
                <footer class="card-footer">
                    <button class="action-button" id="nextChallengeButton" onclick="nextChallenge()">
                         ✨ New Challenge
                    </button>
                    <button class="action-button secondary" onclick="flipCard()">
                        <i class="fas fa-sync-alt"></i>
                        <span>Back to Query</span>
                    </button>
                </footer>
            </div>
        </div>
    </div>

    <script>
        const cardInner = document.getElementById('cardInner');
        const nextChallengeButton = document.getElementById('nextChallengeButton');
        const ttsButton = document.getElementById('ttsButton');

        const questionPromptEl = document.getElementById('questionPrompt');
        const questionContentEl = document.getElementById('questionContent');
        const answerSentenceEl = document.getElementById('answerSentence');
        const grammarExplanationEl = document.getElementById('grammarExplanation').querySelector('span');
        
        let currentAnswer = "";
        let currentChallengeIndex = 0;
        let shuffledChallenges = [];

        const challenges = [
            { prompt: "She / write / a novel", tense: "Past Tense", answer_sentence: "She wrote a novel.", conjugated_verb: "wrote", explanation: "'Wrote' is the irregular past tense of 'write'." },
            { prompt: "They / go / to school", tense: "Past Simple Tense", answer_sentence: "They went to school.", conjugated_verb: "went", explanation: "'Went' is the irregular past tense of 'go'." },
            { prompt: "He / play / football", tense: "Present Progressive Tense", answer_sentence: "He is playing football.", conjugated_verb: "is playing", explanation: "Use 'is' + verb-ing for he/she/it in present progressive." },
            { prompt: "We / speak / English", tense: "Present Progressive Tense", answer_sentence: "We are speaking English.", conjugated_verb: "are speaking", explanation: "Use 'are' + verb-ing for we/they/you in present progressive." },
            { prompt: "They slept", tense: "Make Negative", answer_sentence: "They did not sleep.", conjugated_verb: "did not sleep", explanation: "To make a past simple sentence negative, use 'did not' + base verb." },
            { prompt: "He went to Abha", tense: "Make Negative", answer_sentence: "He did not go to Abha.", conjugated_verb: "did not go", explanation: "Use 'did not' and the base form of the verb 'go'." },
            { prompt: "I / be / a student", tense: "Talk about yourself (Present Simple)", answer_sentence: "I am a student.", conjugated_verb: "am", explanation: "Use 'am' for the verb 'be' with the pronoun 'I'." },
            { prompt: "Ali / eat / an apple", tense: "Present Simple Tense", answer_sentence: "Ali eats an apple.", conjugated_verb: "eats", explanation: "Add '-s' to the verb for third-person singular (Ali) in the present simple." },
            { prompt: "She / cook / food", tense: "Present Simple Tense", answer_sentence: "She cooks food.", conjugated_verb: "cooks", explanation: "Add '-s' to the verb for 'she' in the present simple." },
            { prompt: "He / read / novels", tense: "Used To", answer_sentence: "He used to read novels.", conjugated_verb: "used to read", explanation: "'Used to' describes a past habit or state that is no longer true." },
            { prompt: "She / listen / to the teacher", tense: "Used To", answer_sentence: "She used to listen to the teacher.", conjugated_verb: "used to listen", explanation: "'Used to' is followed by the base form of the verb." }
        ];

        function flipCard() {
            cardInner.classList.toggle('is-flipped');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function displayChallenge(index) {
            const challenge = shuffledChallenges[index];
            
            questionPromptEl.textContent = `Task: ${challenge.tense}`;
            questionContentEl.textContent = challenge.prompt;
            grammarExplanationEl.textContent = challenge.explanation;
            currentAnswer = challenge.answer_sentence;

            const highlightedSentence = challenge.answer_sentence.replace(
                challenge.conjugated_verb,
                `<span class="highlight">${challenge.conjugated_verb}</span>`
            );
            answerSentenceEl.innerHTML = highlightedSentence;
            
            if (cardInner.classList.contains('is-flipped')) {
                flipCard();
            }
        }

        function nextChallenge() {
            currentChallengeIndex++;
            if (currentChallengeIndex >= shuffledChallenges.length) {
                currentChallengeIndex = 0; // Loop back to the beginning
                shuffleArray(shuffledChallenges); // Re-shuffle for a new order
            }
            displayChallenge(currentChallengeIndex);
            nextChallengeButton.textContent = "✨ New Challenge";
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            shuffledChallenges = [...challenges];
            shuffleArray(shuffledChallenges);
            displayChallenge(currentChallengeIndex);
        });

        // --- Gemini API TTS Integration ---
        const apiKey = ""; // API key is handled by the environment
        const ttsModel = "gemini-2.5-flash-preview-tts";
        const ttsApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${ttsModel}:generateContent?key=${apiKey}`;

        async function speakAnswer() {
            if (!currentAnswer) return;
            
            const originalIcon = ttsButton.innerHTML;
            ttsButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            ttsButton.disabled = true;

            const payload = {
                contents: [{ parts: [{ text: currentAnswer }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Puck" } // Cheerful, upbeat voice
                        }
                    }
                }
            };

            try {
                const response = await fetch(ttsApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`TTS API error: ${response.status}`);

                const result = await response.json();
                const audioData = result.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                const mimeType = result.candidates?.[0]?.content?.parts?.[0]?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 24000;
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, 1, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    const audio = new Audio(audioUrl);
                    audio.play();
                } else {
                    throw new Error("Invalid audio data received.");
                }
            } catch (error) {
                console.error("Error with text-to-speech:", error);
            } finally {
                ttsButton.innerHTML = originalIcon;
                ttsButton.disabled = false;
            }
        }

        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcmData, numChannels, sampleRate) {
            const buffer = new ArrayBuffer(44 + pcmData.length * 2);
            const view = new DataView(buffer);
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcmData.length * 2, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * numChannels * 2, true);
            view.setUint16(32, numChannels * 2, true);
            view.setUint16(34, 16, true);
            writeString(view, 36, 'data');
            view.setUint32(40, pcmData.length * 2, true);
            for (let i = 0; i < pcmData.length; i++) {
                view.setInt16(44 + i * 2, pcmData[i], true);
            }
            return new Blob([view], { type: 'audio/wav' });
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }
    </script>
</body>
</html>



